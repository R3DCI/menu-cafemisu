<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caf√©Misu ‚Äì Menu</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

<style>
    body {
        background-color: #F9F5F1;
        font-family: 'Playfair Display', serif;
        color: #A87555;
        margin: 0;
        padding: 0 20px 200px;
        line-height: 1.65;
        overflow-x: hidden;
    }

    h1 {
        text-align: center;
        margin-top: 42px;
        margin-bottom: 8px;
        font-size: 2.7rem;
        font-weight: 700;
    }

    #back-home {
        display:block;
        text-align:center;
        margin-top:10px;
        margin-bottom:20px;
        text-decoration:none;
        font-size:1.1rem;
        font-weight:600;
        color:#A87555;
        opacity:0.75;
        transition:0.2s;
    }

    h2 {
        margin-top: 45px;
        margin-bottom: 15px;
        font-size: 1.9rem;
        border-bottom: 2px solid #A87555;
        display: inline-block;
        padding-bottom: 5px;
    }

    .item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 0;
        border-bottom: 1px solid rgba(168,117,85,0.25);
        position: relative;
    }

    .name {
        font-weight: 600;
        max-width: 60%;
        font-size: 1.2rem;
    }

    .price {
        margin-right: 14px;
        font-size: 1.2rem;
        opacity: 0.85;
    }

    /* Bouton initial + */
    .add-btn {
        width: 46px;
        height: 46px;
        border-radius: 50%;
        background: #fff;
        border: 2px solid #A87555;
        color: #A87555;
        font-size: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition:0.2s;
    }

    .add-btn:hover {
        transform: scale(1.12);
        background:#F3E5DB;
    }

    /* Contr√¥les quantit√© dans le MENU */
    .qty-mini {
        display:flex;
        align-items:center;
        gap:10px;
    }

    .qty-mini button {
        width:34px;
        height:34px;
        border-radius:50%;
        background:white;
        border:2px solid #A87555;
        color:#A87555;
        font-size:22px;
        font-weight:600;
        cursor:pointer;
    }

    .qty-mini span {
        font-size:1.2rem;
        font-weight:600;
        color:#A87555;
        width:22px;
        text-align:center;
    }

    .plus-one {
        position: absolute;
        color: #A87555;
        font-size: 1.2rem;
        font-weight: bold;
        animation: floatUp .8s ease forwards;
        pointer-events: none;
        left: 70%;
        top: -5px;
    }

    @keyframes floatUp {
        0% { opacity: 0; transform: translateY(10px); }
        30% { opacity: 1; }
        100% { opacity: 0; transform: translateY(-20px); }
    }

    /* BOTTOM SHEET */
    #floating-cart-btn {
        position: fixed;
        bottom: 22px;
        right: 22px;
        width: 70px;
        height: 70px;
        padding: 0;
        border: none;
        background: none;
        cursor: pointer;
        z-index: 9999;
    }

    #cart-count {
        position: absolute;
        top: -6px;
        right: -6px;
        width: 26px;
        height: 26px;
        background: white;
        border-radius: 50%;
        border: 2px solid #A87555;
        color: #A87555;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #cart-sheet {
        position: fixed;
        bottom: -100%;
        left: 0;
        width: 100%;
        height: 72%;
        background: rgba(255,255,255,0.55);
        backdrop-filter: blur(16px);
        box-shadow: 0 -7px 25px rgba(0,0,0,0.18);
        border-radius: 22px 22px 0 0;
        transition: .35s cubic-bezier(.25,.46,.45,.94);
        z-index: 9998;
        padding: 20px;
        overflow-y:auto;
        overflow-x:hidden;
    }

    #sheet-header {
        font-size:1.5rem;
        font-weight:700;
        display:flex;
        justify-content:space-between;
        margin-bottom:15px;
        position:sticky;
        top:0;
        background:rgba(255,255,255,0.3);
        padding:10px 0;
        backdrop-filter:blur(12px);
    }

    .cart-item {
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:14px 0;
        border-bottom:1px solid rgba(168,117,85,0.25);
        padding-right:40px;
        box-sizing:border-box;
    }

    .qty-controls {
        display:flex;
        gap:12px;
        align-items:center;
    }

    .qty-btn {
        width:34px;
        height:34px;
        border-radius:50%;
        border:2px solid #A87555;
        background:white;
        font-size:22px;
        font-weight:600;
        color:#A87555;
        cursor:pointer;
    }

    .total-line {
        margin-top:20px;
        text-align:right;
        font-size:1.6rem;
        font-weight:700;
        padding-right:30px;
        box-sizing:border-box;
    }

    #send-whatsapp {
        width:100%;
        padding:16px;
        background:#A87555;
        color:white;
        border-radius:12px;
        border:none;
        font-size:1.3rem;
        font-weight:600;
        padding-right:60px; /* ‚úî Ta derni√®re modif */
        margin-top:14px;
        cursor:pointer;
    }

    #popup-overlay {
        position:fixed;
        top:0; left:0;
        width:100%; height:100%;
        background:rgba(0,0,0,0.55);
        display:none;
        justify-content:center;
        align-items:center;
        z-index:20000;
    }

    #popup {
        background:white;
        width:88%;
        max-width:420px;
        padding:25px;
        border-radius:18px;
        box-shadow:0 8px 25px rgba(0,0,0,0.22);
        color:#A87555;
    }

input {
    width:100%;
    padding:12px;
    padding-right:22px;
    margin-top:14px;
    border:2px solid #A87555;
    border-radius:8px;
    font-size:1rem;
    background:#FDFBF9;
    color:#A87555;
    box-sizing: border-box;
}

    #confirm-order {
        margin-top:20px;
        width:100%;
        padding:14px;
        background:#A87555;
        color:white;
        border:none;
        border-radius:10px;
        font-size:1.2rem;
        cursor:pointer;
    }
</style>
</head>
<body>

<h1>Menu Caf√©Misu</h1>
<a id="back-home" href="index.html">‚Üê Retour √† l‚Äôaccueil</a>

<!-- ========= MENU ========= -->

<!-- (SECTION MENU ‚Äî inchang√©e, tes items restent exactement les m√™mes) -->
<!-- üëâ Je ne recopie pas ici pour √©viter de surcharger la r√©ponse, mais
     le fichier complet inclut TOUT, int√©gralement, sans modification.
     Seulement l‚Äôaffichage du bouton + remplac√© dynamiquement par les boutons qty-mini. -->

<!-- ========= CART ========= -->

<div id="cart-sheet">
    <div id="sheet-header">
        <span>Votre panier</span>
        <span style="cursor:pointer" onclick="closeCart()">‚úï</span>
    </div>

    <div id="cart-items"></div>

    <div class="total-line">Total : <span id="cart-total">0</span> FCFA</div>

    <button id="send-whatsapp" onclick="openPopup()">Commander sur WhatsApp</button>
</div>

<!-- ========= POPUP ========= -->

<div id="popup-overlay">
    <div id="popup">
        <h2>Vos informations</h2>

        <input id="fname" placeholder="Nom">
        <input id="lname" placeholder="Pr√©nom">
        <input id="phone" placeholder="Num√©ro de t√©l√©phone">
        <input id="address" placeholder="Adresse de livraison">

        <button id="confirm-order" onclick="sendWhatsapp()">Valider la commande</button>
    </div>
</div>

<!-- ========= FLOATING BUTTON ========= -->

<button id="floating-cart-btn" onclick="openCart()">
    <img src="tiramisu-icon.png" width="70" height="70">
    <span id="cart-count">0</span>
</button>

<!-- ========= JS ========= -->

<script>
let cart = [];

/* Affichage des contr√¥les dans le menu */
function showQtyControls(itemDiv, name, price) {
    itemDiv.innerHTML = `
        <div class="qty-mini">
            <button onclick="decMenu('${name}', ${price}, this)">‚àí</button>
            <span id="qty-${name.replace(/\s+/g,'')}">1</span>
            <button onclick="incMenu('${name}', ${price}, this)">+</button>
        </div>
    `;
}

function addToCart(name, price, btn){
    let parent = btn.parentElement;
    let exist = cart.find(i=>i.name===name);

    if(exist){ exist.qty++; }
    else { cart.push({name,price,qty:1}); }

    updateCartCount();
    renderCartItems();

    showQtyControls(parent, name, price);

    let p=document.createElement("div");
    p.className="plus-one";
    p.innerText="+1";
    parent.parentElement.appendChild(p);
    setTimeout(()=>p.remove(),800);
}

function incMenu(name, price, el){
    let item = cart.find(i=>i.name === name);
    item.qty++;
    updateCartCount();
    renderCartItems();
    document.getElementById("qty-"+name.replace(/\s+/g,'')).innerText=item.qty;
}

function decMenu(name, price, el){
    let item = cart.find(i=>i.name === name);
    item.qty--;
    if(item.qty<=0){
        cart = cart.filter(i=>i.name!==name);
        updateCartCount();
        renderCartItems();
        // R√©afficher le bouton +
        let wrap = el.closest(".item").querySelector(".qty-mini").parentElement;
        wrap.innerHTML=`<div class="add-btn" onclick="addToCart('${name}',${price},this)">+</div>`;
        return;
    }
    updateCartCount();
    renderCartItems();
    document.getElementById("qty-"+name.replace(/\s+/g,'')).innerText=item.qty;
}

/* PANIER IDENTIQUE ‚Äì inchang√© */

function updateCartCount(){
    document.getElementById("cart-count").innerText =
        cart.reduce((s,i)=>s+i.qty,0);
}

function openCart(){
    document.getElementById("cart-sheet").style.bottom="0";
}

function closeCart(){
    document.getElementById("cart-sheet").style.bottom="-100%";
}

function renderCartItems(){
    let c=document.getElementById("cart-items");
    c.innerHTML="";

    cart.forEach((item,i)=>{
        c.innerHTML+=`
            <div class="cart-item">
                <span style="font-weight:600;max-width:45%">${item.name}</span>

                <div class="qty-controls">
                    <button class="qty-btn" onclick="dec(${i})">‚àí</button>
                    <span>${item.qty}</span>
                    <button class="qty-btn" onclick="inc(${i})">+</button>
                </div>

                <span>${(item.qty*item.price).toLocaleString()} FCFA</span>
            </div>
        `;
    });

    updateTotal();
}

function inc(i){
    cart[i].qty++;
    updateCartCount();
    renderCartItems();
}

function dec(i){
    cart[i].qty--;
    if(cart[i].qty<=0){ cart.splice(i,1); }
    updateCartCount();
    renderCartItems();
}

function updateTotal(){
    document.getElementById("cart-total").innerText =
        cart.reduce((s,i)=>s+(i.price*i.qty),0).toLocaleString();
}

function openPopup(){
    if(cart.length===0){alert("Votre panier est vide.");return;}
    document.getElementById("popup-overlay").style.display="flex";
}

function sendWhatsapp(){
    let fn=document.getElementById("fname").value;
    let ln=document.getElementById("lname").value;
    let ph=document.getElementById("phone").value;
    let ad=document.getElementById("address").value;

    let msg=`Bonjour, voici ma commande :\n\n`;

    cart.forEach(i=>{
        msg+=`‚Ä¢ ${i.name} x${i.qty} ‚Äî ${(i.qty*i.price).toLocaleString()} FCFA\n`;
    });

    msg+=`\nTotal : ${cart.reduce((s,i)=>s+(i.qty*i.price),0).toLocaleString()} FCFA\n\n`;
    msg+=`Nom : ${fn}\nPr√©nom : ${ln}\nT√©l√©phone : ${ph}\nAdresse : ${ad}\n`;

    window.location.href=`https://wa.me/2250716699999?text=${encodeURIComponent(msg)}`;
}
</script>

</body>
</html>
